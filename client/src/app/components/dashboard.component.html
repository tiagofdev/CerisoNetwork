<div class="container-fluid" id="dashboard-component">

  <!-- Left Sidebar -->
  <div class="sidebar-left shadow rounded">

    <ul class="nav flex-column p-3 text-center gap-2 justify-content-center align-content-center">
      <!-- Title -->
      <li class="nav-item">
        <a class="sides btn custom-btn w-100 fw-bold" [routerLink]="'/app-root/login'">Cerisonet</a>
      </li>

      <!-- Icon Buttons -->
      <li class="nav-item">
        <button class="btn custom-btn w-100 shadow-sm" title="Haut" (click)="scrollToTop()">
          <p class="labels">Haut</p><i class="bi bi-arrow-bar-up"></i>
        </button>
      </li>
      <li class="nav-item">
        <a class="btn custom-btn w-100 shadow-sm"  title="Nouveau Message" (click)="showPopup()">
          <p class="labels">Nouveau Message</p><i class="bi bi-send"></i>
        </a>
      </li>


      <!-- FILTER -->
      <li class="nav-item">
        <div style="position: relative;" >
          <a class="btn custom-btn w-100 shadow-sm"  title="Filtrer" (click)="show_filter_menu = !show_filter_menu; show_sorting_menu = false;">
            <p class="labels">Filtrer</p><i class="bi bi-filter"></i>
          </a>

          <div class="sorting flex-column rounded " id="filter"
               *ngIf="show_filter_menu" (keydown.escape)="show_filter_menu = false"
               style="background-color: #fafafa; width: 180px;">

            <div class="row align-content-center text-center justify-content-center text-center m-1" style="height: 40px; background-color: #b8b8b8">
              Filtrer par
            </div>

            <!-- FILTER TYPE -->
            <div class="row m-1" >
              <a class="btn btn-menu shadow-sm w-100 rounded"  #filter_user (click)="click_filter_user(filter_user, filter_hashtag)">Utilisateur</a>
            </div>
            <div class="row m-1" >
              <a class="btn btn-menu shadow-sm w-100 rounded"  #filter_hashtag (click)="click_filter_hashtag(filter_user, filter_hashtag)">Hashtag</a>
            </div>

            <!-- INPUT-->
            <div class="row m-1">
                <input [(ngModel)]="filter_value" (keydown.enter)="applyFilter(); show_filter_menu = false;" >
            </div>

            <!-- APPLY FILTER -->
            <div class="row m-1">
              <a class="btn custom-btn w-100 shadow-sm " style="background-color: #74cc8b;" (click)="applyFilter(); show_filter_menu = false;"
                >Appliquer</a>
            </div>
            <div class="row m-1">
              <a class="btn custom-btn w-100 shadow-sm " style="background-color: #b8b8b8;" (click)="removeFilter(); show_filter_menu = false;"
              >Supprimer</a>
            </div>

          </div>
        </div>
      </li>

      <!-- SORTING -->
      <li class="nav-item">
        <div style="position: relative;">
          <a class="btn custom-btn w-100 shadow-sm" title="Trier" (click)="show_sorting_menu = !show_sorting_menu; show_filter_menu = false;">
            <p class="labels">Trier</p><i class="bi bi-sort-up"></i>
          </a>

          <!-- Sorting hiding -->
          <div class="sorting flex-column rounded" *ngIf="show_sorting_menu" (mouseleave)="show_sorting_menu = false" id="sorting #sorting"
            style="background-color: #fafafa; ">
            <div class="row align-content-center text-center justify-content-center text-center m-1" style="height: 40px; background-color: #b8b8b8">
              Trier par
            </div>
            <div class="row m-1">
              <a class="btn custom-btn w-100 shadow-sm"  title="Date" (click)="sortByDate(); show_sorting_menu = !show_sorting_menu">Date</a>
            </div>
            <div class="row m-1">
              <a class="btn custom-btn w-100 shadow-sm"  title="Utilisateur" (click)="sortByUser(); show_sorting_menu = !show_sorting_menu">Utilisateur</a>
            </div>
            <div class="row m-1">
              <a class="btn custom-btn w-100 shadow-sm"  title="Popularité" (click)="sortByLikes(); show_sorting_menu = !show_sorting_menu">Likes</a>
            </div>

          </div>
        </div>
      </li>

      <!-- DEBUG -->
      <li class="nav-item">
        <a class="btn custom-btn w-100 shadow-sm" [routerLink]="'/restapi'" (click)="removeFilter(); bandeauMsg('Rest API')" title="REST API">
          <p class="labels">REST API</p><i class="bi bi-star"></i>
        </a>
      </li>
    </ul>

  </div>

  <!-- Right Sidebar -->
  <div class="sidebar-right shadow  rounded">
    <ul class="nav flex-column text-dark p-3">
      <li class="nav-item"><a class="nav-link text-dark" href="#"><i class="bi bi-person"></i> Connectés</a></li>
      <ng-container *ngFor="let user of active_users">
        <li><img src="assets/greendot.png" style="width: 16px;"/> {{ user.username }}</li>
      </ng-container>

    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="flex-grow-1 p-4 main-content" id="main-content">

      <ng-container *ngFor="let post of filtered_list">
        <div class="mb-3">
        <div class="msg card" [routerLink]="['/post', post._id]">
          <div class="card-body d-flex">
            <!-- Main Content -->
            <div class="flex-grow-1">
              <!-- Header: Name + Date -->
              <div class="d-flex justify-content-between align-items-center mb-2">

                <div class="fw-bold text-success" *ngIf="post.sharedBy==null"><img src="{{getAvatar(post.createdBy)}}" style="width: 42px;"/> {{ post.pseudo }}</div>
                <div class="fw-bold text-success" *ngIf="post.sharedBy!=null"><img src="{{getAvatar(post.createdBy)}}" style="width: 42px;"/> {{ post.pseudo }} partage le post:</div>
                <div class="text-muted small">{{ post.date }} {{ post.hour }}</div>
              </div>

              <!-- Hashtags -->
              <div class="mb-2">
                <ng-container *ngFor="let tag of post.hashtags">
                  <span class="badge bg-light text-success border border-success me-1">{{tag}}</span>
                </ng-container>
              </div>

              <!-- Thumbnail Image -->
              <div class="mb-2">
                <img alt="" src="{{post.images?.url}}" class="img-fluid rounded">
              </div>

              <!-- Post Body -->
              <p class="text-muted">{{ post.body }}</p>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex flex-column ms-3 shadow-sm" >

              <button class="btn btn-light text-success fw-semibold mb-2"
                      *ngIf="post.likedBy.includes(user_id) && post.sharedBy==null" (click)="likePost(post._id);">
                <i class="bi bi-hand-thumbs-up-fill"></i> {{ post.likes }}
              </button>

              <button class="btn btn-light text-success fw-semibold mb-2"
                      *ngIf="!post.likedBy.includes(user_id) && post.sharedBy==null" (click)="likePost(post._id);">
                <i class="bi bi-hand-thumbs-up"></i> {{ post.likes }}
              </button>

              <button class="btn btn-light text-success fw-semibold mb-2">
                <i class="bi bi-chat-dots" (click)="post.showComments = !post.showComments"
                ></i> {{ post.comments.length }}
              </button>
              <button class="btn btn-light text-success fw-semibold" *ngIf="post.sharedBy==null"
                (click)="sharePost(post._id)">
                <i class="bi bi-share"></i> {{ post.shares }}
              </button>
            </div>
          </div>
        </div>

        <!-- Shared Post -->

        <div class="share card mb-1 " *ngIf="post.sharedBy!=null;">
          <ng-container *ngIf="getPostById(post.sharedBy) as sharedPost">
            <div class="card-body d-flex">
              <!-- Main Content -->
              <div class="flex-grow-1">
                <!-- Header: Name + Date -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <div class="fw-bold text-success"><img src="{{getAvatar(sharedPost.createdBy)}}" style="width: 42px;"/> {{ sharedPost.pseudo }}</div>

                  <div class="text-muted small">{{ sharedPost.date }} {{ sharedPost.hour }}</div>
                </div>

                <!-- Hashtags -->
                <div class="mb-2">
                  <ng-container *ngFor="let tag of sharedPost.hashtags">
                    <span class="badge bg-light text-success border border-success me-1">{{tag}}</span>
                  </ng-container>
                </div>

                <!-- Thumbnail Image -->
                <div class="mb-2">
                  <img alt="" src="{{sharedPost.images?.url}}" class="img-fluid rounded">
                </div>

                <!-- Post Body -->
                <p class="text-muted">{{ sharedPost.body }}</p>
              </div>

              <!-- Action Buttons -->
              <div class="d-flex flex-column ms-3 shadow-sm" *ngIf="sharedPost.sharedBy==null">

                <button class="btn btn-light text-success fw-semibold mb-2"
                        *ngIf="sharedPost.likedBy.includes(user_id)" (click)="likePost(sharedPost._id);">
                  <i class="bi bi-hand-thumbs-up-fill"></i> {{ sharedPost.likes }}
                </button>

                <button class="btn btn-light text-success fw-semibold mb-2"
                        *ngIf="!sharedPost.likedBy.includes(user_id)" (click)="likePost(sharedPost._id);">
                  <i class="bi bi-hand-thumbs-up"></i> {{ sharedPost.likes }}
                </button>

                <button class="btn btn-light text-success fw-semibold" (click)="sharePost(sharedPost._id)">
                  <i class="bi bi-share"></i> {{ sharedPost.shares }}
                </button>

                <button class="btn btn-light text-success fw-semibold mb-2">
                  <i class="bi bi-chat-dots" (click)="sharedPost.showComments = !sharedPost.showComments"
                  ></i> {{ sharedPost.comments.length }}
                </button>
              </div>

            </div>
            <div class="cmt card mb-4 shadow-sm" *ngIf="sharedPost.showComments">
              <div class="m-0 shadow border-top-2" style="padding: 8px 0 0 12px;">
                <p>Commentaires</p>
              </div>

              <div style="overflow: scroll;">
                <ng-container *ngFor="let comment of sharedPost.comments">
                  <div class="card-body">
                    <!-- Header: Name + Date -->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <div class="fw-bold text-success">{{ comment.commentedBy }}</div>
                      <div class="text-muted small">{{ comment.date }} {{ comment.hour }}</div>
                    </div>
                    <!-- Comment Body -->
                    <p class="text-muted">{{ comment.text }}</p>
                  </div>
                </ng-container>
              </div>

              <div class="h-25 col d-inline-block p-3 shadow-lg border-top-2">
                <form (ngSubmit)="addComment(sharedPost._id)">
                  <div class="row p-1">
                <textarea [(ngModel)]="comment_input"
                          name="comment_input"
                          class="form-control" rows="2"
                          placeholder="Ajouter Commentaire..." required>
                </textarea>
                  </div>
                  <div class="row  p-1 align-items-end">
                    <button type="submit" class="btn" style="background-color: #74cc8b">Commenter</button>
                  </div>
                </form>
              </div>
            </div>
          </ng-container>
        </div>


        <!-- Comments -->

        <div class="cmt card mb-4 shadow-sm" *ngIf="post.showComments">
          <div class="m-0 shadow border-top-2" style="padding: 8px 0 0 12px;">
            <p>Commentaires</p>
          </div>

          <div style="overflow: scroll;">
            <ng-container *ngFor="let comment of post.comments">
              <div class="card-body">
                <!-- Header: Name + Date -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <div class="fw-bold text-success">{{ comment.commentedBy }}</div>
                  <div class="text-muted small">{{ comment.date }} {{ comment.hour }}</div>
                </div>
                <!-- Comment Body -->
                <p class="text-muted">{{ comment.text }}</p>
              </div>
            </ng-container>
          </div>

          <div class="h-25 col d-inline-block p-3 shadow-lg border-top-2">
            <form (ngSubmit)="addComment(post._id)">
              <div class="row p-1">
                <textarea [(ngModel)]="comment_input"
                          name="comment_input"
                          class="form-control" rows="2"
                          placeholder="Ajouter Commentaire..." required>
                </textarea>
              </div>
              <div class="row  p-1 align-items-end">
                <button type="submit" class="btn" style="background-color: #74cc8b">Commenter</button>
              </div>
            </form>
          </div>
        </div>

        </div>
      </ng-container>
    </div>
  </div>







  <popup *ngIf="staticPopup" (close)="hidePopup()"></popup>

</div>

